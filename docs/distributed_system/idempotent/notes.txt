# 幂等性
f(f(x)) = f(x)
什么情况下需要考虑幂等性：重复提交、接口重试、前端抖动，并不是所有接口都要求幂等性
需要幂等的场景如：支付、下单
如何保证：通过唯一的业务单号保证幂等
非并发：查询业务单号是否有被操作过，没有则执行操作，并发的情况：整个过程加锁

select、delete天然幂等，update使用数据版本号，通过乐观锁实现幂等
insert：此时没有业务唯一单号，使用token保证幂等
混合操作：有业务唯一单号则使用，否则使用token

# update操作幂等性
根据唯一业务号去更新数据的情况：
用户查询出要修改的数据，系统将数据返回给页面，前端将数据版本号放入隐藏域
用户修改数据点击提交，将版本号一同提交给后台
后台使用版本号作为更新条件

# insert操作幂等性
若有唯一业务号，直接分布式锁锁住唯一业务号，设置自动过期时间为30秒
没有唯一业务号的insert操作，如：用户注册，点击多次
使用token机制，保证幂等性
进入到注册页，后台统一生成token，返回给客户端隐藏域
用户页面提交时将token一同传入后台
使用token获取分布式锁，完成insert
执行成功后，不释放锁，等过期自动释放

Token在进入页面时后端生成返回给客户端，要保证只能使用一次，使用过后删除token








