脏读：指读取到其他事务正在处理的未提交数据
不可重复读：指并发更新时，另一个事务前后查询相同数据时的数据不符合预期
幻读：指并发新增、删除这种会产生数量变化的操作时，另一个事务前后查询相同数据时的不符合预期

事务隔离级别                 脏读可能性 不可重复读可能性  幻读可能性          加锁读
READ UNCOMMITTED(读未提交)    是         是             是               否
READ COMMITTED(读已提交)      否         是             是               否
REPEATABLE READ(可重复度)     否         否             是(innodb除外)    否
SERIALIZABLE(可串行化)        否         否             否               是

#获取当前事务隔离界别，默认RR(REPEATABLE-READ)可重复读
SHOW VARIABLES LIKE 'transaction_isolation';
#设置当前会话事务隔离级别为“读未提交”
SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;

MySQL默认Repeatable Read(RR)-可重复读，MySQL 5.1以后默认存储引擎就是InnoDB，因此MySQL默认RR也能解决幻读问题
innodb引擎在可重复度级别下也可解决幻读

三大参数：
sync_binlog
innodb_flush_log_at_trx_commit
innodb_doublewrite

mysql三大日志详解
https://javaguide.cn/database/mysql/mysql-logs.html

REDO_LOG：物理日志，记录的是在某个数据页上做了什么修改，属于InnoDB存储引擎。
数据更新是直接更新到Buffer Pool，然后记录redo log落盘，记录的是数据页上做了什么修改的日志记录。
刷盘情况：事务提交时通过参数控制(innodb_flush_log_at_trx_commit)、log buffer空间不足时、事务日志缓冲区满、检查点(定期)、后台刷新线程、关闭服务器
innodb_flush_log_at_trx_commit的值有3种：
  0：事务提交时不进行刷盘操作，等待后台线程刷盘
  1(默认)：每次事务提交时都将进行刷盘操作
  2：每次事务提交时都只把log buffer里的redo log内容写入page cache

BIN_LOG：逻辑日志，记录内容是语句的原始逻辑(statement(SQL)/ROW/mixed)，属于MySQL Server层。
sync_binlog：控制binlog的write和fsync的时机
  默认是1，表示每次提交事务都会执行fsync
  IO瓶颈时可以设置为N(N>1)，表示每次提交事务都write，但累积N个事务后才fsync，如果机器宕机会丢失最近N个事务的binlog日志。

innodb_doublewrite：ON
操作系统在将页写入磁盘的过程中发生崩溃，在恢复过程中，innodb存储引擎可以从共享表空间的doublewrite中找到该页的一个最近的副本，将其复制到表空间文件，再应用redo log，就完成了恢复过程。

MVCC：依赖于 隐藏字段、Read View、undo log
https://javaguide.cn/database/mysql/innodb-implementation-of-mvcc.html
在MySQL InnoDB存储引擎下RC、RR基于MvCC(多版本并发控制)进行并发事务控制
MVCC是基于”数据版本”(undo_log)对并发事务进行访问
UNDO_LOG：逻辑日志，记录的是SQL语句
MySQL确保版本链数据不再被“引用"后再进行删除。

ReadView是“快照读”SQL执行时MVCC提取数据的依据
快照读：就是最普通的Select查询SQL语句
当前读：指代执行下列语句时进行数据读取的方式
lnsert、Update、Delete
Select...for update
Select...lock in share mode

ReadView是一个数据结构，包含4个字段
m_ids：当前活跃的事务编号集合
min_trx_id：最小活跃事务编号
max_trx_id：预分配事务编号，当前最大事务编号+1
creator_trx_id：ReadView创建者的事务编号

读已提交(RC):在每一次执行快照读时生成ReadView
可重复读(RR):仅在第一次执行快照读时生成ReadView，后续快照读复用。
（例外：一个事务中连续两个快照读中出现当前读，切当前读有覆盖到了其他事务新增的数据。会生成两个ReadView导致幻读）

版本链数据访问规则:
判断当前事务id等于creator_trx_id(4)吗?成立说明数据就是自己这个事务更改的，可以访问
判断trx_id < min_trx_id(2)?成立说明数据已经提交了，可以访问
判断trx_id> max_trx_id(5)?成立说明该事务是在ReadView生成以后才开启，不允许访问
判断min_trx_id(2]<= trx_id <= max_trx_id(5)，成立在m_ids数据中对比，不存数据在的则代表数据是已提交的，可以访问。




